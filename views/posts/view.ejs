<%- include('../partials/header') %>

<style>
  body {
    background-color: #fafafa;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  }

  .container {
    max-width: 600px;
    margin: 40px auto;
    background: #fff;
    border: 1px solid #dbdbdb;
    border-radius: 8px;
    padding: 10px;
  }

  .ig-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px;
    border-bottom: 1px solid #dbdbdb;
  }

  .ig-header img {
    border-radius: 50%;
    width: 32px;
    height: 32px;
    margin-right: 10px;
  }

  .ig-header strong {
    font-size: 14px;
  }

  .ig-post img {
    width: 100%;
    max-height: 500px;
    object-fit: cover;
  }

  .ig-actions {
    display: flex;
    justify-content: space-between;
    padding: 10px;
    font-size: 22px;
  }

  .ig-body {
    padding: 0 10px 10px;
  }

  .ig-body p {
    margin: 4px 0;
    font-size: 14px;
  }

  .likes {
    font-weight: 600;
  }

  .ig-comments {
    font-size: 14px;
    margin-top: 5px;
  }

  .ig-add-comment {
    display: flex;
    align-items: center;
    padding: 10px;
    border-top: 1px solid #dbdbdb;
  }

  .ig-add-comment input {
    flex: 1;
    border: none;
    outline: none;
    font-size: 14px;
  }

  .ig-add-comment button {
    border: none;
    background: none;
    color: #0095f6;
    font-weight: 600;
    cursor: pointer;
  }

  .timestamp {
    font-size: 10px;
    text-transform: uppercase;
    color: #8e8e8e;
    margin-top: 5px;
  }
</style>

<% if (post) { %>
  <div class="container">
    <!-- Post Header -->
    <div class="ig-header">
      <div class="d-flex align-items-center">
        <strong><%= post.author.username %></strong>
      </div>
      <i class="bi bi-three-dots"></i>
    </div>

    <!-- Post Image -->
    <div class="ig-post">
      <% if (post.imageUrl) { %>
        <img src="<%= post.imageUrl %>" alt="Post by <%= post.author.username %>">
      <% } else { %>
        <p class="text-muted text-center mt-3">No image uploaded.</p>
      <% } %>
    </div>

    <!-- Post Actions -->
    <div class="ig-actions">
      <form action="/posts/<%= post.id %>/like" method="POST">
        <% if (user && post.likes.some(like => like.userId === user.id)) { %>
          <button type="submit" class="btn p-0 border-0"><i class="bi bi-heart-fill text-danger"></i></button>
        <% } else { %>
          <button type="submit" class="btn p-0 border-0"><i class="bi bi-heart"></i></button>
        <% } %>
      </form>
      <i class="bi bi-chat"></i>
      <i class="bi bi-send"></i>
      <i class="bi bi-bookmark"></i>
    </div>

    <!-- Post Body -->
    <div class="ig-body">
      <p class="likes"><%= post.likes.length %> like(s)</p>
      <p class="caption"><strong><%= post.author.username %></strong> <%= post.content %></p>

      <!-- Comments -->
      <% if (post.comments.length > 0) { %>
        <div class="ig-comments">
          <% post.comments.forEach(comment => { %>
            <p><strong><%= comment.user.username %></strong> <%= comment.text %></p>
          <% }) %>
        </div>
      <% } else { %>
        <div class="text-muted">No comments yet.</div>
      <% } %>

      <p class="timestamp"><%= new Date(post.createdAt).toLocaleDateString() %></p>
    </div>

    <!-- Add Comment -->
    <form action="/posts/<%= post.id %>/comments" method="POST" class="ig-add-comment">
      <input type="text" name="text" placeholder="Add a comment..." required>
      <button type="submit">Post</button>
    </form>
  </div>
<% } else { %>
  <div class="text-center mt-5 text-muted">Post not found.</div>
<% } %>

<%- include('../partials/footer') %>


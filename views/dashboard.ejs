<%- include('partials/header') %>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

<style>
  /* Reset & full width */
  html, body {
    height: 100%;
    width: 100%;
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: #f3f4f6;
    font-family: 'Inter', sans-serif;
    box-sizing: border-box;
  }

  /* Override bootstrap/container centering */
  .container, .container-fluid, .navbar, header, .site-header {
    width: 100% !important;
    max-width: 100% !important;
    padding-left: 0 !important;
    padding-right: 0 !important;
    margin: 0 !important;
  }

  /* Layout wrapper */
  .layout-wrapper {
    display: flex;
    height: 100vh;
    width: 100vw;
    margin: 0;
    padding: 0;
    gap: 0;
    align-items: stretch;
    justify-content: stretch;
    overflow: hidden;
  }

  /* Sidebar */
  .sidebar {
    width: 260px;
    min-width: 260px;
    height: 100vh;
    background: #fff;
    padding: 1.5rem 1rem;
    overflow-y: auto;
    border-right: 1px solid #e5e7eb;
    display: flex;
    flex-direction: column;
    align-items: stretch;
  }

  .sidebar .text-center {
    text-align: center;
    margin-bottom: 1.5rem;
  }

  .sidebar .avatar {
    border-radius: 50%;
    object-fit: cover;
  }

  /* Username & stats */
  .username {
    font-weight: 600;
    font-size: 18px;
    margin-top: 10px;
    color: #333;
  }

  .follow-stats {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 30px;
    margin-top: 10px;
    font-size: 14px;
    color: #666;
  }

  .follow-stats strong {
    font-size: 16px;
    color: #111;
  }

  /* Sidebar menu */
  .sidebar-menu {
    display: flex;
    flex-direction: column;
    width: 100%;
    margin-top: 20px;
  }

  .sidebar-menu a {
    text-decoration: none;
    color: #333;
    padding: 0.7rem 1rem;
    border-radius: 8px;
    font-weight: 500;
    margin-bottom: 4px;
    transition: background 0.2s;
  }

  .sidebar-menu a:hover {
    background-color: #f0f0f0;
  }

  /* Main content */
  .main-content {
    flex: 1 1 auto;
    width: auto !important;
    min-width: 0;
    height: 100vh;
    padding: 1.5rem;
    overflow-y: auto;
    background: transparent;
  }

  /* Feed grid */
  .feed-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    width: 100%;
  }

  .feed-card {
    position: relative;
    border-radius: 10px;
    overflow: hidden;
    cursor: pointer;
  }

  .feed-card img {
    width: 100%;
    height: 250px;
    object-fit: cover;
    display: block;
  }

  .feed-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.35);
    opacity: 0;
    transition: opacity .18s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
    font-weight: 600;
  }

  .feed-card:hover .feed-overlay { opacity: 1; }

  /* Suggestion panel */
  .suggestion-panel {
    width: 300px;
    min-width: 300px;
    height: 100vh;
    overflow-y: auto;
    padding: 1.2rem;
    background: #fff;
    border-left: 1px solid #e5e7eb;
    box-shadow: none;
  }

  .avatar, .suggestion-avatar {
    border-radius: 50%;
    object-fit: cover;
    display: inline-block;
  }

  .btn-blue {
    background-color: #1877f2;
    color: #fff;
    border: none;
    padding: .35rem .8rem;
    border-radius: 8px;
    font-weight: 600;
  }

  h1,h2,h3,h4,h5,h6,p {
    margin: 0;
    padding: 0;
  }

  body, .layout-wrapper, .main-content, .sidebar, .suggestion-panel {
    -webkit-overflow-scrolling: touch;
  }
</style>


<div class="layout-wrapper">
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="text-center mb-4">
      <img src="<%= currentUser.profilePic || '/images/default-avatar.png' %>" class="avatar" width="80" height="80">

      <div class="username"><%= currentUser.username %></div>

      <div class="follow-stats">
        <div>
          <strong><%= currentUser.followersCount || 2802 %></strong><br>
          <span>Followers</span>
        </div>
        <div>
          <strong><%= currentUser.followingCount || 980 %></strong><br>
          <span>Following</span>
        </div>
      </div>
    </div>

    <nav class="sidebar-menu">
      <a href="#">üè† Home</a>
      <a href="/users/friends">üë• Friends</a>

      <a href="#">üé• Watch</a>
      <a href="#">üìÑ Pages</a>
      <a href="#">üìÖ Events</a>
      <a href="#">üõí Marketplace</a>
    </nav>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <div class="d-flex align-items-center mb-4">
      <img src="<%= currentUser.profilePic || '/images/default-avatar.png' %>" class="avatar" width="80" height="80">

      <h4 class="mb-0">Welcome, <%= currentUser.username %>!</h4>
    </div>

    <div class="mb-4">
      <a href="/users/<%= currentUser.id %>" class="btn btn-outline-info me-2">üë§ View My Profile</a>
      <a href="/posts/new" class="btn btn-blue">+ New Post</a>
    </div>

    <% if (posts.length > 0) { %>
      <div class="feed-grid">
        <% posts.forEach(function(post) { %>
          <a href="/posts/<%= post.id %>" class="feed-card">
            <img src="<%= post.imageUrl || '/images/default-post.png' %>" alt="Post Image">
            <div class="feed-overlay">
              ‚ù§Ô∏è <%= post.likes?.length || 0 %> &nbsp;&nbsp; üí¨ <%= post.comments?.length || 0 %>
            </div>
          </a>
        <% }); %>
      </div>
    <% } else { %>
      <p class="text-muted">No posts yet from you or people you follow.</p>
    <% } %>
  </div>

  <!-- Suggested Users -->
<div class="suggestion-panel">
  <h5 class="mb-3">Suggested Users</h5>
  <% if (otherUsers.length === 0) { %>
    <p class="text-muted">No suggestions yet.</p>
  <% } else { %>
    <% otherUsers.forEach(function(user) { %>
      <div class="d-flex align-items-center justify-content-between mb-3">
        <div class="d-flex align-items-center">
          <!-- ‚úÖ Show uploaded profile picture if available, else default avatar -->
          <img 
            src="<%= user.profilePic || user.imageUrl || '/images/default-avatar.png' %>" 
            class="suggestion-avatar me-2" 
            width="40" 
            height="40" 
            alt="<%= user.username %>'s profile picture">

          <div>
            <strong><%= user.username %></strong><br>
            <a href="/users/<%= user.id %>" 
               class="text-decoration-none text-primary" 
               style="font-size: 0.85rem;">
              View Profile
            </a>
          </div>
        </div>

        <form action="/users/<%= user.id %>/follow" method="POST">
          <button type="submit" class="btn btn-blue btn-sm">
            <%= followingIds.includes(user.id) ? 'Unfollow' : 'Follow' %>
          </button>
        </form>
      </div>
    <% }); %>
  <% } %>
</div>




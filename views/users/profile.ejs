<%- include('../partials/header') %>

<div class="container my-4">
  <div class="card shadow-sm mb-4">
    <div class="card-body text-center">

      <!-- Profile image -->
      <% if (user.imageUrl) { %>
        <img src="<%= user.imageUrl %>" alt="Profile Picture" class="rounded-circle mb-3" style="width: 120px; height: 120px; object-fit: cover;">
      <% } else { %>
        <img src="/images/default-avatar.png" alt="Default Avatar" class="rounded-circle mb-3" style="width: 120px; height: 120px; object-fit: cover;">
      <% } %>

      <!-- Username + email -->
      <h3 class="fw-bold"><%= user.username %></h3>
      <p class="text-muted mb-1"><%= user.email %></p>

      <!-- ✅ Bio -->
      <% if (user.bio) { %>
        <p class="mt-2"><%= user.bio %></p>
      <% } %>

      <!-- ✅ Show Edit Bio button if this is currentUser's own profile -->
      <% if (currentUser && currentUser.id === user.id) { %>
        <hr>
        <form action="/users/<%= user.id %>" method="POST">
          <div class="mb-3">
            <label for="bio" class="form-label">Edit Your Bio</label>
            <textarea name="bio" id="bio" class="form-control" rows="3"><%= user.bio || '' %></textarea>
          </div>
          <button type="submit" class="btn btn-primary">Update Bio</button>
        </form>
      <% } else { %>
        <!-- ✅ Follow/unfollow button -->
        <form action="/users/<%= user.id %>/follow" method="POST">
          <button class="btn btn-outline-success mt-3">Follow</button>
        </form>
      <% } %>

    </div>
  </div>

  <!-- ✅ Follower / Following / Post count section -->
  <div class="text-center mb-4">
    <strong>Followers:</strong> <%= followersCount %> |
    <strong>Following:</strong> <%= followingCount %> |
    <strong>Posts:</strong> <%= user.posts ? user.posts.length : 0 %>
  </div>

  <!-- ✅ User's Posts -->
  <div>
    <h4 class="fw-bold mb-3">Posts by <%= user.username %></h4>

    <% if (user.posts && user.posts.length > 0) { %>
      <% user.posts.forEach(post => { %>
        <div class="card mb-3">
          <% if (post.imageUrl) { %>
            <img src="<%= post.imageUrl %>" class="card-img-top" alt="Post Image">
          <% } %>
          <div class="card-body">
            <p><%= post.content %></p>
            <small class="text-muted">Posted on <%= new Date(post.createdAt).toDateString() %></small>
          </div>
        </div>
      <% }) %>
    <% } else { %>
      <p class="text-muted">No posts yet.</p>
    <% } %>
  </div>
</div>

<%- include('../partials/footer') %>




